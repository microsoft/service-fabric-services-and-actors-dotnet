<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <AssemblyInfoFile>AssemblyInfo_AutoGenerated.cs</AssemblyInfoFile>
    <FinalVersion>$(MajorVersion).$(MinorVersion).$(BuildVersion).$(Revision)</FinalVersion>
  </PropertyGroup>

  <ItemGroup>
    <Compile Include="$(AssemblyInfoFile)" />
  </ItemGroup>

  <!-- Properties for Version has already been set by service_fabric_managed_common.props which is imported by all .csproj -->
  <Target Name="SetAssemblyVersion">
    <Message Text="Setting Assembly Versions for project $(ProjectName)"/>
    <ItemGroup>
      <MyItems Include=
               "//------------------------------------------------------------------------------;
               // This file was auto-generated during build by $(MSBuildThisFileDirectory)\AssemblyVersioning.targets;
               //------------------------------------------------------------------------------;
               [assembly: System.Reflection.AssemblyVersion(&quot;$(FinalVersion)&quot;)];
               [assembly: System.Reflection.AssemblyFileVersion(&quot;$(FinalVersion)&quot;)]"/>
    </ItemGroup>

    <WriteLinesToFile
        File="$(AssemblyInfoFile)"
        Lines="@(MyItems)"
        Overwrite="true"/>
  </Target>

  <Target Name="DeleteAssemblyInfo">
    <Message Text="Deleting temporary Assembly Versions File for project $(ProjectName)"/>
    <Delete Files="$(AssemblyInfoFile)" />
  </Target>

  <PropertyGroup>
    <BuildDependsOn>SetAssemblyVersion;$(BuildDependsOn);DeleteAssemblyInfo</BuildDependsOn>
  </PropertyGroup>
</Project>